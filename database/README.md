# PostgreSQL –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Father's MATH

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è PostgreSQL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker
- Docker Compose

### –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
./database/start-db.sh
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
./database/stop-db.sh
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã
- **subjects** - –ü—Ä–µ–¥–º–µ—Ç—ã (–∞–ª–≥–µ–±—Ä–∞, –≥–µ–æ–º–µ—Ç—Ä–∏—è, —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è, –º–∞—Ç. –∞–Ω–∞–ª–∏–∑)
- **topics** - –¢–µ–º—ã –≤–Ω—É—Ç—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- **subtopics** - –ü–æ–¥—Ç–µ–º—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–º
- **lessons** - –£—Ä–æ–∫–∏ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- **tags** - –¢–µ–≥–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
- **lesson_tags** - –°–≤—è–∑—å —É—Ä–æ–∫–æ–≤ –∏ —Ç–µ–≥–æ–≤ (many-to-many)
- **theory_images** - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö —É—Ä–æ–∫–æ–≤

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
```
subjects (1) ‚Üí topics (1) ‚Üí subtopics (1) ‚Üí lessons (many)
                                    ‚Üì
                              lesson_tags (many) ‚Üê tags (many)
                                    ‚Üì
                              theory_images (many)
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
./database/backup-db.sh
```
–°–æ–∑–¥–∞–µ—Ç –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ `./database/backups/`

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
```bash
./database/restore-db.sh ./database/backups/fathers_math_backup_20241201_120000.sql
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```bash
docker-compose exec postgres psql -U fathers_math_user -d fathers_math
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
docker-compose logs postgres
```

## üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

- **Host**: localhost
- **Port**: 5432
- **Database**: fathers_math
- **Username**: fathers_math_user
- **Password**: fathers_math_password

## üê≥ Docker –∫–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
docker-compose up -d postgres
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker-compose down
```

### –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è –¥–∞–Ω–Ω—ã–µ)
```bash
docker-compose down -v
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker-compose up -d --build postgres
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
database/
‚îú‚îÄ‚îÄ init/
‚îÇ   ‚îú‚îÄ‚îÄ 01_create_tables.sql    # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
‚îÇ   ‚îî‚îÄ‚îÄ 02_insert_initial_data.sql  # –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ backups/                    # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
‚îú‚îÄ‚îÄ start-db.sh                # –ó–∞–ø—É—Å–∫ –ë–î
‚îú‚îÄ‚îÄ stop-db.sh                 # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ë–î
‚îú‚îÄ‚îÄ backup-db.sh               # –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ restore-db.sh              # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ README.md                  # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π SQL —Ñ–∞–π–ª –≤ `init/` —Å –Ω–æ–º–µ—Ä–æ–º –±–æ–ª—å—à–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
2. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã ALTER TABLE –∏–ª–∏ CREATE TABLE
3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker-compose up -d --build postgres`

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose ps
```

### –ü–æ—Ä—Ç 5432 –∑–∞–Ω—è—Ç
```bash
# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –ø–æ—Ä—Ç
lsof -i :5432

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL (–µ—Å–ª–∏ –µ—Å—Ç—å)
sudo systemctl stop postgresql
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x database/*.sh
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ `docker-compose.yml`!

```yaml
environment:
  POSTGRES_PASSWORD: –≤–∞—à_—Å–ª–æ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
docker-compose exec postgres pg_isready -U fathers_math_user -d fathers_math
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü
```sql
SELECT 
    schemaname,
    tablename,
    attname,
    n_distinct,
    correlation
FROM pg_stats
WHERE schemaname = 'public'
ORDER BY tablename, attname;
```
