<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Отладка математических формул</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <style>
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .formula-test {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .formula-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .formula-latex {
            font-family: monospace;
            background: #f5f5f5;
            padding: 5px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .formula-result {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            min-height: 40px;
        }
        .success {
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left: 4px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>Отладка математических формул</h1>
        <p>Проверяем проблемные формулы с KaTeX</p>
        
        <div id="debugResults"></div>
    </div>
    
    <script src="js/model/mathFormulas.js"></script>
    <script>
        // Тестируем проблемные формулы
        function debugFormulas() {
            const mathFormulas = new MathFormulas();
            const debugContainer = document.getElementById('debugResults');
            
            const problemFunctions = [
                "Rational",
                "Gaussian bell", 
                "Sine",
                "Logarithm",
                "Rose curve",
                "Butterfly (polar)"
            ];
            
            problemFunctions.forEach(functionName => {
                const testDiv = document.createElement('div');
                testDiv.className = 'formula-test';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'formula-name';
                nameDiv.textContent = functionName;
                testDiv.appendChild(nameDiv);
                
                const latexFormula = mathFormulas.getFormula(functionName);
                const displayFormula = mathFormulas.getDisplayFormula(functionName);
                
                const latexDiv = document.createElement('div');
                latexDiv.className = 'formula-latex';
                latexDiv.textContent = `LaTeX: ${latexFormula}`;
                testDiv.appendChild(latexDiv);
                
                const displayDiv = document.createElement('div');
                displayDiv.className = 'formula-latex';
                displayDiv.textContent = `Display: ${displayFormula}`;
                testDiv.appendChild(displayDiv);
                
                const resultDiv = document.createElement('div');
                resultDiv.className = 'formula-result';
                
                console.log(`Testing ${functionName}:`);
                console.log(`  LaTeX: ${latexFormula}`);
                
                // Пытаемся рендерить с KaTeX
                if (typeof katex !== 'undefined' && katex.render) {
                    try {
                        const formulaElement = document.createElement('div');
                        formulaElement.className = 'math-formula';
                        
                        katex.render(latexFormula, formulaElement, {
                            displayMode: false,
                            throwOnError: false,
                            errorColor: '#cc0000',
                            macros: {
                                "\\ln": "\\ln",
                                "\\log": "\\log",
                                "\\sin": "\\sin",
                                "\\cos": "\\cos",
                                "\\tan": "\\tan",
                                "\\exp": "\\exp",
                                "\\frac": "\\frac",
                                "\\sqrt": "\\sqrt",
                                "\\theta": "\\theta",
                                "\\pi": "\\pi",
                                "\\delta": "\\delta",
                                "\\left": "\\left",
                                "\\right": "\\right"
                            },
                            strict: false,
                            trust: true
                        });
                        
                        resultDiv.appendChild(formulaElement);
                        testDiv.classList.add('success');
                        console.log(`  ✅ KaTeX rendering successful`);
                        
                    } catch (error) {
                        console.error(`  ❌ KaTeX rendering failed:`, error);
                        resultDiv.innerHTML = `<div style="color: red;">Ошибка KaTeX: ${error.message}</div>`;
                        resultDiv.innerHTML += `<div>Fallback: ${displayFormula}</div>`;
                        testDiv.classList.add('error');
                    }
                } else {
                    console.warn(`  ⚠️ KaTeX not available`);
                    resultDiv.innerHTML = `<div style="color: orange;">KaTeX недоступен</div>`;
                    resultDiv.innerHTML += `<div>Fallback: ${displayFormula}</div>`;
                    testDiv.classList.add('error');
                }
                
                testDiv.appendChild(resultDiv);
                debugContainer.appendChild(testDiv);
            });
        }
        
        // Запускаем отладку после загрузки страницы
        document.addEventListener('DOMContentLoaded', debugFormulas);
    </script>
</body>
</html>
