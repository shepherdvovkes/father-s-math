<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест математических формул</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Тест математических формул</h1>
            <p>Проверка отображения формул с KaTeX</p>
        </header>
        
        <main>
            <div class="control-panel">
                <h3>Тестовые формулы</h3>
                <div id="testFormulas"></div>
            </div>
        </main>
    </div>
    
    <script src="js/model/mathFormulas.js"></script>
    <script>
        // Тестируем отображение формул
        function testFormulas() {
            const mathFormulas = new MathFormulas();
            const testContainer = document.getElementById('testFormulas');
            
            const testFunctions = [
                "Linear",
                "Quadratic", 
                "Rational",
                "Power (|x|^b)",
                "Gaussian bell",
                "Sine",
                "Logarithm",
                "Rose curve",
                "Butterfly (polar)"
            ];
            
            testFunctions.forEach(functionName => {
                const formulaDiv = document.createElement('div');
                formulaDiv.className = 'section';
                
                const title = document.createElement('h4');
                title.textContent = functionName;
                formulaDiv.appendChild(title);
                
                const formulaDisplay = document.createElement('div');
                formulaDisplay.className = 'formula-display';
                
                const latexFormula = mathFormulas.getFormula(functionName);
                const displayFormula = mathFormulas.getDisplayFormula(functionName);
                
                console.log(`Testing ${functionName}:`);
                console.log(`  LaTeX: ${latexFormula}`);
                console.log(`  Display: ${displayFormula}`);
                
                // Пытаемся рендерить с KaTeX
                if (typeof katex !== 'undefined' && katex.render) {
                    try {
                        const formulaElement = document.createElement('div');
                        formulaElement.className = 'math-formula';
                        
                        katex.render(latexFormula, formulaElement, {
                            displayMode: false,
                            throwOnError: false,
                            errorColor: '#cc0000',
                            macros: {
                                "\\ln": "\\ln",
                                "\\log": "\\log",
                                "\\sin": "\\sin",
                                "\\cos": "\\cos",
                                "\\tan": "\\tan",
                                "\\exp": "\\exp",
                                "\\frac": "\\frac",
                                "\\sqrt": "\\sqrt",
                                "\\theta": "\\theta",
                                "\\pi": "\\pi",
                                "\\delta": "\\delta",
                                "\\left": "\\left",
                                "\\right": "\\right"
                            },
                            strict: false,
                            trust: true
                        });
                        
                        formulaDisplay.appendChild(formulaElement);
                        console.log(`  ✅ KaTeX rendering successful`);
                        
                    } catch (error) {
                        console.error(`  ❌ KaTeX rendering failed:`, error);
                        formulaDisplay.innerHTML = `<div class="formula-placeholder">Ошибка KaTeX: ${displayFormula}</div>`;
                    }
                } else {
                    console.warn(`  ⚠️ KaTeX not available, using fallback`);
                    formulaDisplay.innerHTML = `<div class="formula-placeholder">KaTeX недоступен: ${displayFormula}</div>`;
                }
                
                formulaDiv.appendChild(formulaDisplay);
                testContainer.appendChild(formulaDiv);
            });
        }
        
        // Запускаем тест после загрузки страницы
        document.addEventListener('DOMContentLoaded', testFormulas);
    </script>
</body>
</html>
